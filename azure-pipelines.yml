# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

jobs:  
- job: Build
  displayName: Build 

  pool:
    vmImage: 'ubuntu-latest'
      
  steps:
  - task: Maven@3
    inputs:
      mavenPomFile: 'pom.xml'
      publishJUnitResults: true
      testResultsFiles: '**/surefire-reports/TEST-*.xml'
      javaHomeOption: 'JDKVersion'
      mavenVersionOption: 'Default'
      mavenAuthenticateFeed: false
      effectivePomSkip: false
      sonarQubeRunAnalysis: false

  - task: Docker@2
    inputs:
      containerRegistry: 'DockerSC'
      repository: 'naveen412/azurepipeline'
      command: 'buildAndPush'
      Dockerfile: 'Dockerfile'

  - upload: manifests
    artifact: manifests

- job: Deploy
  pool:
    vmImage: 'ubuntu-latest'
    
  steps:
  - task: KubernetesManifest@0
    inputs:
      action: 'deploy'
      kubernetesServiceConnection: 'kubesc'
      namespace: 'default'
      manifests: 'manifests'
      containers: 'naveen412/azurepipeline'




    




  